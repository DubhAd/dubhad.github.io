---
layout: post
title: Zigbee2MQTT - Native to Docker migration
date: '2021-05-02T03:30:00.001+01:00'
author: Tinkerer
tags:
- docker
- zigbee2mqtt
modified_time: '2021-05-02T03:30:00.208+01:00'
---

<p>&nbsp;A long time ago I started using Zigbee2MQTT - somewhere around 1.2 or 1.3. Back then I thought that it was easiest to run Zigbee2MQTT with a manual install, which was (and still is) the default instructions you'll find.</p><p>Since then I've seen the light. Docker makes upgrades, and downgrades, so much easier. Installing a new version is no longer a nightmare with compiling and installing packages - it's two commands and a short wait.</p><p>But, if you've started with a manual install, how do you migrate without having to re-pair everything?&nbsp;</p><p>The answer is that it's pretty much the same as for when you migrate Home Assistant from a <a href="https://blog.ceard.tech/2020/10/ha-venv-to-docker.html" target="_blank">venv to Docker</a>:</p><p></p><ol style="text-align: left;"><li>Install Docker and Docker Compose</li><li>Configure your container to use the existing config folder</li><li>Done (well, mostly)</li></ol><h2 style="text-align: left;">Install</h2><div>Install <a href="https://docs.docker.com/engine/install/" target="_blank">Docker CE</a>&nbsp;and <a href="https://docs.docker.com/compose/install/" target="_blank">Docker Compose</a>. If you're on a Raspberry Pi <a href="https://withblue.ink/2020/06/24/docker-and-docker-compose-on-raspberry-pi-os.html" target="_blank">see this guide</a> since you need to install Compose using pip.</div><div><br /></div><div>Next you'll want to pick a folder to keep all your Docker configs in. I like to use <kbd>/data</kbd> for the top level, and <kbd>/data/docker</kbd> for my compose file(s). Other people use <kbd>/docker</kbd> for their compose files and folders under there for the container's config folders.</div><div><br /></div><div>Now you can follow the official Zigbee2MQTT docs, though you will already know where your USB stick is (just look in the existing config).</div><h2 style="text-align: left;">Configure</h2><div>Next step is to write your <kbd>docker-compose.yml</kbd> file, which will look something like this:</div><pre>version: '3'<br />services:<br />  zigbee2mqtt:<br />    container_name: zigbee2mqtt<br />    image: koenkk/zigbee2mqtt<br />    volumes:<br />      - /opt/zigbee2mqtt/data:/app/data<br />    devices:<br />      - /dev/ttyACM0:/dev/ttyACM0<br />    restart: unless-stopped<br />    network_mode: host<br />    environment:<br />      - TZ=Europe/London<br /></pre><div>Change the device path to suit your USB stick, and the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank">timezone to suit you</a>.</div><h2 style="text-align: left;">Finish</h2><div>Now it's time to disable and stop the old install, and then start your new container.</div><pre>cd /data/docker<br />sudo docker-compose pull<br />sudo systemctl disable zigbee2mqtt<br />sudo systemctl stop zigbee2mqtt<br />sudo docker-compose up -d<br /></pre><div>You can check the logs now either by looking in the config folder, as before, or by using <kbd>docker compose logs -f zigbee2mqtt</kbd> when in the folder with your compose file.</div><div><br /></div><div>When it comes time to update Zigbee2MQTT you just repeat the pull and up steps:</div><pre>docker-compose pull<br />docker-compose up -d<br /></pre><p>If you need to revert to the manual install for any reason then you can easily do that.</p>