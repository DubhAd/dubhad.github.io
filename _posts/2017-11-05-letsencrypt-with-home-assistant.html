---
layout: post
title: LetsEncrypt with Home Assistant
date: '2017-11-05T19:46:00.000Z'
author: Tinkerer
tags:
- ssl
- home assistant
modified_time: '2018-01-16T10:46:29.400Z'
---

Many people want to have remote access to their Home Assistant system, whether for an API (eg Google Assistant), or simply to be able to check on their home while away.<br /><br />At the simplest you need a hostname that resolves to your external (WAN) IP address, and for those with a dynamic IP (which is most) then the <a href="https://home-assistant.io/components/duckdns/">DuckDNS component</a> solves that. But that doesn't enable encryption (aka HTTPS). If you're on Hass.io then it already has an add-on to handle it all, but for everybody else you need to solve that bit manually.<br /><h3>Setting up the certificate</h3>Fortunately <a href="https://letsencrypt.org/">LetsEncrypt</a> makes that easy through their <a href="https://certbot.eff.org/about/">certbot tool</a>. Unfortunately there are few guides on using it with Home Assistant, and people get stuck. With that in mind, let's begin, using the <kbd>pi</kbd> for all the commands, <strong>not</strong> the <kbd>homeassistant</kbd> account<br /><ol><li>Forward port <kbd>80</kbd> on your router to port <kbd>80</kbd> on your Home Assistant system - you'll need to also forward another port for HTTPS access, this one is for certbot</li><li><a href="https://certbot.eff.org/docs/install.html">Install certbot</a></li><li>Request a certificate with <br /><kbd>$ sudo certbot-auto certonly --standalone --preferred-challenges http -d example.duckdns.org</kbd><br />(replace <kbd>example.duckdns.org</kbd> with your actual domain)</li><li>Configure Home Assistant's <a href="https://home-assistant.io/components/http/">http component</a> with the certificate locations</li><li>Forward the port for HTTPS access (you can use <kbd>8123</kbd>, or <kbd>443</kbd>, or anything above <kbd>1024</kbd> that you're not already using)</li><li>Test it out from outside your network</li></ol><div>Now, you might run into problems. Sometimes the permissions on some of the letsencrypt folders don't get set correctly - the give away is an error that includes <kbd>Invalid config for [http]: not a file for dictionary value @ data['http']['ssl_certificate']</kbd>. If that happens try the following command:</div><div><pre>$ sudo chmod a+x /etc/letsencrypt/live /etc/letsencrypt/keys /etc/letsencrypt/archive</pre></div><div>Then try again.<br /><h3>Renewing the certificate</h3></div><div>To renew your certificate, create a file called&nbsp;<kbd>/etc/cron.daily/certbot</kbd> and put the following in it:</div><div><pre>#!/bin/sh<br />/usr/local/bin/certbot-auto renew<br /></pre>Home Assistant will detect the updated certificate automatically and start using it, you don't need to restart. Once you've done that, you'll need to run:</div><pre>$ sudo chmod a+rx /etc/cron.daily/certbot<br /></pre><div>It's possible that certbot-auto won't be installed in <kbd>/usr/local/bin</kbd> - you can check that by running: <br /><pre>$ which certbot-auto</pre>If that's the case use that path in the script above.</div>