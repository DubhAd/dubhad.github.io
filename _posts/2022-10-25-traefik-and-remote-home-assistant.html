---
layout: post
title: Traefik and a remote Home Assistant
date: '2022-10-25T21:17:00.000+01:00'
author: Tinkerer
tags:
- remote access
- home assistant
modified_time: '2022-10-25T21:17:39.273+01:00'
---

<p>I've been playing with <a href="https://traefik.io/" target="_blank">Traefik</a> lately, for remote access for various things in my Docker stack, and I decided to see if it was possible to also use it for Home Assistant, despite that being on a remote host.</p><p>The answer is (otherwise I wouldn't have written this) yes - and I can continue my practice of limiting access to only parts of the API I want to expose. I used <a href="https://medium.com/@containeroo/traefik-2-0-route-external-services-through-traefik-7bf2d56b1057" target="_blank">this guide</a> to get myself going.</p><p>There's nothing special about the core of my <a href="https://gist.github.com/DubhAd/5fffb74c683dd0d96f71d41928ca502a" target="_blank">Traefik configuration</a>. I'm using <a href="https://zerossl.com/" target="_blank">ZeroSSL</a> here, instead of <a href="https://letsencrypt.org/" target="_blank">LetsEncrypt</a>, purely because I'm already using LetsEncrypt for my existing proxy and didn't want to hit rate limits while experimenting.</p><p>I'm using the <a href="https://doc.traefik.io/traefik/providers/file/" target="_blank">file provider</a> to define the connection to Home Assistant, and that configuration too is <a href="https://gist.github.com/DubhAd/d6d95418ef3b57e282bd556007461fba" target="_blank">pretty simple</a>. The key is the <kbd>loadBalancer</kbd> setting, that directs Traefik to the remote host.</p><h3 style="text-align: left;">Step by step</h3><p>Set up your file (or in this case folder) provider, eg:</p><pre>providers:<br />  docker:<br />    exposedByDefault: false<br />  file:<br />    directory: /config<br />    watch: true</pre>Any configuration files that are dropped in that folder will be automatically loaded since <kbd>watch</kbd> is set to true. The same goes for any changes to existing files.<div><br /></div><div>Next set up the <a href="https://doc.traefik.io/traefik/routing/routers/" target="_blank">router</a> - in this case I'm using <kbd>http.yml</kbd> in the folder mapped as <kbd>/config</kbd>:<pre>http:<br />  routers:<br />    homeassistant:<br />      entryPoints:<br />        - "websecure"<br />      rule: "Host(`homeassistant.example.org`) &amp;&amp; ( PathPrefix(`/api/webhook`) || PathPrefix(`/api/telegram_webhooks`) || PathPrefix(`/api/frigate/notifications`) )"<br />      tls:<br />        certResolver: zerossl<br />        domains:<br />          - main: "homeassistant.example.org"<br />      service: homeassistant</pre><div>The key things to note here are:</div><div><ul style="text-align: left;"><li>I'm limiting access to only parts of the API that I want to have remote access to. That is:</li><ul><li>Webhooks for things like GPSLogger and the official Home Assistant Android app</li><li>Telegram bot</li><li>Frigate notifications&nbsp;</li></ul><li>I've explicitly named the hostname for the certificate. This apparently isn't needed, though for some reason it wouldn't generate a certificate request until I did this.</li></ul></div><div>I didn't initially appreciate that Traefik uses backticks, not normal quotes, in the config file, which did cause me a bit of wasted time.</div><div><br /></div>The <a href="https://doc.traefik.io/traefik/routing/services/" target="_blank">service</a> goes in the same file:<pre>  services:<br />    homeassistant:<br />      loadBalancer:<br />        servers:<br />          - url: "http://192.168.1.42:8123"<br />        passHostHeader: true</pre>Now all you have to do is restart Traefik to load the file provider config, which then loads everything else. If it all went well you'll have a new working HTTP Router and Service entry in your Traefik dashboard, with a TLS domain, it not it's time to check the logs to see what went wrong.</div>