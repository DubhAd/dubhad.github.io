---
layout: post
title: Home Assistant, avoiding insecurity
date: '2018-01-29T08:30:00.000Z'
author: Tinkerer
tags:
- security
- remote access
- home assistant
modified_time: '2018-02-05T21:34:21.013Z'
---

So, you're running Home Assistant, you've opened it up to the Internet, and you're worried about security?&nbsp; You're not alone, so read on and see what you can do, and shouldn't do.<br /><h3>Keeping Secrets</h3><div>Home Assistant has a configuration option for&nbsp;<a href="https://home-assistant.io/docs/configuration/secrets/">secrets</a>. This is very useful for re-using values, but most importantly it makes it safer to share your configuration. For example, here's a snippet from&nbsp;<a href="https://github.com/DubhAd/Home-AssistantConfig/blob/master/configuration.yaml">my configuration.yaml</a>:</div><pre>  latitude: !secret latitude<br />  longitude: !secret longitude<br />  elevation: !secret elevation</pre>Now I can share the configuration without you being able to see where I live. The same goes with passwords, usernames, and other sensitive information. I can share my configuration (<a href="https://github.com/DubhAd/Home-AssistantConfig/">and I do</a>) without worrying that I might accidentally give away something sensitive.<br /><br />Many people new to Home Assistant pass this by, but even if you're not exposing your system to the Internet, you should be using secrets.<br /><h3>The Home Assistant account</h3><div>First off, run Home Assistant as a user other than your daily driver. Set up a dedicated account just for Home Assistant, one without a password. This is exactly how the old AIO installer, and Hassbian, do it, and if you read the manual install guide for the&nbsp;<a href="https://home-assistant.io/docs/installation/raspberry-pi/">Raspberry Pi</a>, exactly how that does it too.</div><div><br /></div><div>There's a constant stream of bad advice on Discord and the forum about setting a password for the user you run Home Assistant as, and adding it to sudoers, so that it can use sudo without a password.</div><div><br /></div><div><b>Don't do it!</b></div><div><b><br /></b></div><div>Doing this reduces the security of your system, particularly enabling it to run any command without a password. If your API password turns out to be weak, or is in a leak, any malicious individual know has the easy potential of full access to your system, and from there the rest of your network.</div><h3>Home Assistant API Password</h3>Home Assistant does have password support, and if you're not doing authentication anywhere else, you absolutely must use it. The downside is that there is a single password (and no username associated with it), so make <i>very sure</i> you've picked a strong password. Given that it's used in URLs you'll need to ensure it's URL safe, which for simplicity means letters and numbers only. Make it random, and make it long (at least a dozen characters, more is better). Use a password manager to generate one for you (I like <a href="https://www.lastpass.com/">LastPass</a>, but there's also <a href="https://keepass.info/">KeePass</a> and many others).<br /><br />There is a long running <a href="https://community.home-assistant.io/t/multiple-users-accounts/396">feature request on the forum</a>&nbsp;for support for multiple accounts. It's long running because replacing the authentication is non-trivial, so we'll all just have to wait for some developer to pick this up.<br /><br />This limitation is <a href="/2018/01/nginx-and-home-assistant.html">why I use NGINX</a> and perform authentication through it. I also use it for SSL support, and on that point...<br /><h3>Use SSL</h3>Seriously, use it. If you're running Hass.io they even provide a combined <a href="https://community.home-assistant.io/t/multiple-users-accounts/396">Duck DNS and Let's Encrypt add-on</a>, and a separate <a href="https://home-assistant.io/addons/lets_encrypt/">Let's Encrypt add-on</a> for those who're using another DNS provider. For everybody else, it's not terribly hard, and I <a href="/2017/11/letsencrypt-with-home-assistant.html">covered it here</a>.<br /><br />SSL ensures that your password isn't sent unencrypted, which given that you've only got a single password for Home Assistant, is a really good thing.<br /><h3>Consider a proxy</h3>The advantage of a proxy is that you can provide finer grained access control. In addition to being able to do more robust authentication here (as mentioned above), you can limit access to parts of the API by IP range, user agent, and more.<br /><h3>Use fail2ban</h3>Whether you're using a proxy or not, <a href="https://www.fail2ban.org/wiki/index.php/Main_Page">fail2ban</a> and the <a href="https://home-assistant.io/components/sensor.fail2ban/">associated sensor</a>. Is a great way of cutting off people who're trying to to brute force your password. Whether you're using a proxy, or Home Assistant directly, it's a worthwhile addition.<br /><h3>Updates</h3><div>Keep your Home Assistant system up to date. Ensure you update the underlying operating system updated regularly, ideally automatically. On Debian based systems like the Raspberry Pi there's an <a href="https://wiki.debian.org/UnattendedUpgrades">unattended upgrades package</a> to handle that for you.</div><div><br /></div><div>Similarly, keep Home Assistant upgraded. Not only does that make it easier to track the breaking changes, but it ensures you don't end up with an outdated, and insecure, system.</div><h3>Obscurity</h3><div>Obscurity isn't security, but if you're running services on a default or common port, you'll get more probes, and more chances for others to find any mistakes you made. If you chose to run on a random high numbered port, the volume of those will reduce significantly.</div><h3>Backups</h3><div>Backups aren't security. They are however what you'll need if your security has failed you. Backups kept on the system itself, or easily accessible from it, can be wiped by a malicious attacker. A VPS provider I once used had this happen when their security failed them. This is why I <a href="/2017/10/backing-up-home-assistant.html">pull my backups</a> from a remote computer, as well as pushing them to an online repository.<br /><br /><i>Footnotes</i><br /><ul><li><i>As well as secrets, before I upload to GitHub I do an automatic re-write of my configuration, replacing people's names with place holders, and place names with other place holders. This is done with a script that does a simple search and replace for a list of key terms.</i></li></ul></div>