---
layout: post
title: The great migration - part two
date: '2019-08-28T07:30:00.003+01:00'
author: Tinkerer
tags:
modified_time: '2019-08-28T07:30:34.423+01:00'
---

Well, that was less exciting than I'd feared.<br /><br />The first stage is done. Z-Wave is running on the Pi, and everything else runs on the VM, communicating over MQTT and the REST API.<br /><br />This is built from:<br /><br /><ul><li><a href="https://github.com/DubhAd/Home-AssistantConfig/tree/master/binary_sensors/zwave">Binary sensors</a> - ones to track the states of the sensors, and ones to track the state of what we want the switches to be.</li><li>Some <a href="https://github.com/DubhAd/Home-AssistantConfig/tree/master/switch/zwave">MQTT switches</a> - to consume the state published by the Z-Wave system, that publish to a topic watched by one of the binary sensors</li><li><a href="https://github.com/DubhAd/Home-AssistantConfig/tree/master/scripts/zwave">One script</a> per switch entity</li><li>A <a href="https://github.com/DubhAd/Home-AssistantConfig/blob/master/rest_command/jarvis_zwave.yaml">REST command</a> - to send commands to the Z-Wave system</li><li>A <a href="https://github.com/DubhAd/Home-AssistantConfig/tree/master/automation/platform/zwave">set of automations</a> to glue all this together.</li><ul><li><a href="https://github.com/DubhAd/Home-AssistantConfig/blob/master/automation/platform/zwave/zwave_actions.yaml">One uses</a> the state of the binary sensor (as set by the switch) to call the right script</li><li><a href="https://github.com/DubhAd/Home-AssistantConfig/blob/master/automation/platform/zwave/zwave_sync.yaml">Another</a> sends an MQTT publish command when the switch changes state</li><li><a href="https://github.com/DubhAd/Home-AssistantConfig/blob/master/automation/platform/zwave/zwave_resync.yaml">The last</a> ensures that if the switch and boolean get out of sync, we update the boolean - things do sometimes get out of sync</li></ul></ul><h3>Horrible hack</h3><div>Yes, it <i>is</i> a horrible hack.&nbsp;</div><div><br /></div><div>This is purely to hold me over until I migrate to Zwave2MQTT, using the <a href="https://github.com/robertsLando/Zwave2Mqtt-docker">Docker container</a>. I'm going to do that on on a fresh Pi though, so that if it goes horribly wrong it'll be trivial to revert. It does sound like people have had mixed results, largely coming down to what devices they're using.</div>