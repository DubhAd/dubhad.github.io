---
layout: post
title: How not to break manual control of devices with automations
date: '2018-01-17T20:30:00.000Z'
author: Tinkerer
tags:
- input boolean
- automation
- home assistant
modified_time: '2018-02-07T07:17:41.482Z'
---

A common problem that comes up all the time is when people want a light or switch (or anything else Home Assistant can control) to turn off automatically, but only if it was turned on with an automation.<br /><br />The answer to this is to use an <a href="https://home-assistant.io/components/input_boolean/">input boolean</a> that you turn on when you run the "on" automation, and<br />you use in the "off" automation. This is your flag to indicate whether the switch was turned on by a person, or an automation.<br /><pre>input_boolean:<br />  your_switch_auto_on:<br />    name: "Automatically turned on your switch"<br />    initial: off</pre>Next you have your "on" automation. Here we're using a motion sensor turning on to trigger the turning on of the switch:<br /><pre>automation:<br />  - alias: "Turn on the switch"<br />    initial_state: "on"<br />    trigger:<br />      - platform: state<br />        entity_id: binary_sensor.hall_motion<br />        to: 'on'<br />    condition:<br />      - condition: state<br />        entity_id: switch.your_switch<br />        state: 'off'<br />    action:<br />      - service: switch.turn_on<br />        entity_id: switch.your_switch<br />      - service: input_boolean.turn_on<br />        entity_id: input_boolean.your_switch_auto_on</pre>You'll notice that we turn on the switch, and we also turn on the input boolean to say that we turned it on automatically.<br /><br />Now we have our "off" automation, that says after 5 minutes of no motion, we turn off the switch if we turned it on automatically:<br /><pre>  - alias: "Turn off the switch"<br />    initial_state: "on"<br />    trigger:<br />      - platform: state<br />        entity_id: binary_sensor.hall_motion<br />        to: 'off'<br />        for:<br />          minutes: 5<br />    condition:<br />      - condition: state<br />        entity_id: input_boolean.your_switch_auto_on<br />        state: 'on'<br />      - condition: state<br />        entity_id: switch.your_switch<br />        state: 'on'<br />    action:<br />      - service: switch.turn_off<br />        entity_id: switch.your_switch</pre>You'll note that I'm only trying to turn it off if it was on, just in case somebody turned it off manually.<br /><br />But wait, we haven't turned off the input boolean, and what if somebody turns the light off manually? This is where a third (and final) automation comes in: <br /><pre>  - alias: "Switch turned off"<br />    initial_state: "on"<br />    trigger:<br />      - platform: state<br />        entity_id: switch.your_switch<br />        to: 'off'<br />    condition:<br />      - condition: state<br />        entity_id: input_boolean.your_switch_auto_on<br />        state: 'on'<br />    action:<br />      - service: input_boolean.turn_off<br />        entity_id: input_boolean.your_switch_auto_on</pre>Now, when the switch is turned off, for any reason, it'll turn off the input boolean.