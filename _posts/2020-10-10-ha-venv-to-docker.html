---
layout: post
title: HA venv to Docker
date: '2020-10-10T09:05:00.001+01:00'
author: Tinkerer
tags:
- docker
- venv
- linux
- python
- home assistant
modified_time: '2020-10-10T14:30:00.056+01:00'
---

Another year, another Python deprecation, another flood of posts asking how to upgrade a Python venv.&nbsp; <div><br /></div><div>While you can certainly <a href="https://blog.ceard.tech/2017/12/upgrading-python-virtual-environment.html" target="_blank">do that</a>, another option would be to move to Docker (at least assuming you're running on Linux). Then you don't have to do this next year.  Moving to Docker is pretty simple, it's largely a case of <a href="https://www.home-assistant.io/docs/installation/docker/" target="_blank">following the docs</a>, and writing a compose file that points to your existing config.</div><h2 style="text-align: left;">Summary</h2><div><ol style="text-align: left;"><li>Install Docker CE, either from your distro's package manager or following <a href="https://docs.docker.com/engine/install/" target="_blank">the official docs</a></li><li>Install Docker Compose</li><li>Write your compose file</li><li>Stop your venv, and disabled the service</li><li>Start your container</li></ol><h2 style="text-align: left;">Install Docker</h2></div><div>Install Docker, I personally prefer to <a href="https://docs.docker.com/engine/install/" target="_blank">use the official repositories</a>, or if you're on a Pi use the convenience script. Those are more up to date than you'll get with your distro.</div><div><br /></div><div>Once you've installed it, enable the service and start Docker - this is covered in the official docs so I won't cover it here.</div><h2 style="text-align: left;">Install Docker Compose</h2><div>Install <a href="https://docs.docker.com/compose/install/" target="_blank">Docker Compose</a>, this allows you to manage your container configuration in YAML, and is a <i>good thing</i>.</div><h2 style="text-align: left;">Write your compose file</h2><div>For convenience, create <kbd>/docker</kbd> to store your compose file in - it makes it easier to find in the future.</div><div><br /></div><div>Then, assuming your current config is in <kbd>/home/homeassistant/.homeassistant</kbd> you'll use the following <kbd>docker-compose.yml</kbd> file:</div><div><pre>version: '3'<br />services:<br />  homeassistant:<br />    container_name: home-assistant<br />    image: homeassistant/home-assistant:stable<br />    volumes:<br />      - /home/homeassistant/.homeassistant:/config<br />    environment:<br />      - TZ=Europe/London<br />    restart: always<br />    network_mode: host</pre></div><div>Obviously you'll want to update the timezone to match where you live. If you have any directly connected devices (eg USB sticks), you'll need to map those <a href="https://www.home-assistant.io/docs/installation/docker/#exposing-devices" target="_blank">as explained here</a>. Once that's done you'll want to pull the image before continuing (the following assumes your user is in the <kbd>docker</kbd> group):</div><div><br /></div><div><kbd>docker-compose pull</kbd></div><h2 style="text-align: left;">End the venv</h2><div>Exactly how you do this will depend on your setup, but it'll likely be something like:</div><div><pre>sudo systemctl stop home-assistant@homeassistant<br />sudo systemctl disable home-assistant@homeassistant</pre></div><h2 style="text-align: left;">Start your container</h2><div>In <kbd>/docker</kbd>, type the following:</div><div><pre>docker-compose up -d homeassistant</pre></div><div>You can watch the container logs with:</div><div><pre>docker-compose logs --tail -100 -f homeassistant</pre></div><div>That gives you the last 100 lines, and then follows the output.</div><div><br /></div><div>Finally, see <a href="https://www.home-assistant.io/docs/installation/docker/#docker-compose" target="_blank">the Home Assistant docs</a> for further information on working with HA in Docker, at least until you learn more about Docker.</div>