---
layout: post
title: 'Sniffing encrypted Zigbee traffic '
date: '2021-08-17T20:02:00.000+01:00'
author: Tinkerer
tags:
- zigbee
modified_time: '2021-08-17T20:02:43.428+01:00'
---

<p><a href="https://github.com/Tediore" target="_blank">A friend</a> wrote this summary on Discord. <i>It's not my work</i>, but I thought it should be captured for others. As they said, it's largely based on the <a href="https://www.zigbee2mqtt.io/how_tos/how_to_sniff_zigbee_traffic.html" target="_blank">Zigbee2MQTT sniffing guide</a>.</p><span><a name='more'></a></span><p>My first time using zigbee sniffing to grab the network key from something and read the encrypted traffic was a success.</p><p>For anyone who's wondering how grabbing the network key works... the Zigbee network key is encrypted by a well-known key known as the <i>default trust center link key</i>. Because of that, you can grab the network key for a Zigbee network by using sniffing software and:</p><p></p><ol style="text-align: left;"><li>Put the coordinator in pairing mode</li><li>Pair a device to the coordinator</li><li>Sniff the traffic during pairing, and eventually you'll see a Transport key packet which contains the network key</li><li>Add that network key to the software you're using to sniff Zigbee traffic (in my case, a java program that sniffs the traffic and forwards it to a loopback interface which you then listen to in Wireshark)</li><li>You'll now be able to see exactly what commands are happening (turning lights on/off, changing brightness, etc)</li></ol><p></p><p>Zigbee 3.0 prevents the network key sniffing from happening with the introduction of install codes which are unique per individual device and replace the <i>default trust center link key</i></p><p>To pair a device with this new secure method, you have to tell the Zigbee&nbsp;software what the install code is (and it has to support Zigbee 3.0 install codes)</p><p>So yes, in case you're wondering: somebody could sniff your Zigbee&nbsp;network key and snoop on your network or even inject commands. However, they'd have to be within range and sniffing at the exact time that you're pairing a device (or if a device rejoins the network with insecure rejoin)</p><p>In other words... highly unlikely unless somebody knows you have a Zigbee&nbsp;network, knows where you live, is within proximity of your network, and wants to target you specifically for some unfathomable reason, and is sniffing at the right time. Oh, and you don't notice the unmarked van with a giant antenna parked in your driveway.</p>