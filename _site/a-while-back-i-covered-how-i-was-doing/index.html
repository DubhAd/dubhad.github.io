<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Presence detection updated - Tinkering with Technology</title>
<meta name="description" content="A while back I covered how I was doing presence detection, and thought that since I’ve changed a few things I should update.">


  <meta name="author" content="Tinkerer">
  
  <meta property="article:author" content="Tinkerer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Tinkering with Technology">
<meta property="og:title" content="Presence detection updated">
<meta property="og:url" content="http://0.0.0.0:4000/a-while-back-i-covered-how-i-was-doing/">


  <meta property="og:description" content="A while back I covered how I was doing presence detection, and thought that since I’ve changed a few things I should update.">







  <meta property="article:published_time" content="2018-09-06T21:00:00+01:00">





  

  


<link rel="canonical" href="http://0.0.0.0:4000/a-while-back-i-covered-how-i-was-doing/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Tinkerer",
      "url": "http://0.0.0.0:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tinkering with Technology Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Tinkering with Technology
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://0.0.0.0:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Presence detection updated</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/tinkerer.png" alt="Tinkerer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Tinkerer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Tinkering with technology for a long long time. I was once a sysadmin, but then I saw the light and escaped.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Milliways</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/DubhAd" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://github.com/DubhAd/Home-AssistantConfig/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-house-signal" aria-hidden="true"></i><span class="label">My HA config</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Presence detection updated">
    <meta itemprop="description" content="A while back I covered how I was doing presence detection, and thought that since I’ve changed a few things I should update.">
    <meta itemprop="datePublished" content="2018-09-06T21:00:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Presence detection updated
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2018-09-06T21:00:00+01:00">September 6, 2018</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>A while back I covered how I <a href="/home-assistant-and-basic-presence/">was doing presence detection</a>, and thought that since I’ve changed a few things I should update.</p>

<h2 id="little-big-changes">Little Big Changes</h2>

<p>I’ve ditched groups for tracking. There’s a simple reason for this - the group is a blunt instrument. I still use them indirectly, and I’ll explain how below. When I say blunt instrument, I mean that if any device tracker reports me as home, I’m home. Which is fine, until one misbehaves. Then I flip flop between home and away as each group member updates.</p>

<h2 id="bayesian">Bayesian</h2>

<p>This is nice because I can weight individual things that indicate whether we may be home.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bayesian'</span>  
  <span class="na">prior</span><span class="pi">:</span> <span class="s">0.6</span>  
  <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">person2</span><span class="nv"> </span><span class="s">Home'</span>  
  <span class="na">probability_threshold</span><span class="pi">:</span> <span class="s">0.95</span>  
  <span class="na">observations</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">entity_id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">device_tracker.person2_mobile'</span>  
      <span class="na">prob_given_true</span><span class="pi">:</span> <span class="s">0.9</span>  
      <span class="na">platform</span><span class="pi">:</span> <span class="s1">'</span><span class="s">state'</span>  
      <span class="na">to_state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">home'</span>  
    <span class="pi">-</span> <span class="na">entity_id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">device_tracker.person2_mobile_bt'</span>  
      <span class="na">prob_given_true</span><span class="pi">:</span> <span class="s">0.9</span>  
      <span class="na">platform</span><span class="pi">:</span> <span class="s1">'</span><span class="s">state'</span>  
      <span class="na">to_state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">home'</span>  
    <span class="pi">-</span> <span class="na">entity_id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">device_tracker.person2_mobile_gps'</span>  
      <span class="na">prob_given_true</span><span class="pi">:</span> <span class="s">0.8</span>  
      <span class="na">platform</span><span class="pi">:</span> <span class="s1">'</span><span class="s">state'</span>  
      <span class="na">to_state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">home'</span>
</code></pre></div></div>

<p>Basically, it requires that at least two out of the three trackers (WiFi, Bluetooth, GPS) report me as home, before I’m home. Initial testing is looking positive.</p>

<p>Why am I weighting the GPS down a bit? Well, it doesn’t change things here, but I’ve found it less reliable in terms of home/away. This is just my way of noting that.</p>

<h2 id="automation">Automation</h2>

<p>Until I’m comfortable that’s working as intended, I’m using the following automation:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">initial_state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">on'</span>  
  <span class="na">alias</span><span class="pi">:</span> <span class="s1">'</span><span class="s">person2</span><span class="nv"> </span><span class="s">home'</span>  
  <span class="na">trigger</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>  
      <span class="na">entity_id</span><span class="pi">:</span>   
      <span class="pi">-</span> <span class="s">device_tracker.person2_mobile</span>  
      <span class="pi">-</span> <span class="s">device_tracker.person2_mobile_bt</span>  
      <span class="pi">-</span> <span class="s">device_tracker.person2_mobile_gps</span>  
      <span class="na">to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">home'</span>  
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">homeassistant</span>  
      <span class="na">event</span><span class="pi">:</span> <span class="s">start</span>  
  <span class="na">condition</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">numeric_state</span>  
      <span class="na">entity_id</span><span class="pi">:</span> <span class="s">group.person_person2</span>  
      <span class="na">above</span><span class="pi">:</span> <span class="s">1</span>  
      <span class="na">value_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">dict((states|selectattr('entity_id',</span><span class="nv"> </span><span class="s">'in',</span><span class="nv"> </span><span class="s">state_attr('group.person_person2',</span><span class="nv"> </span><span class="s">'entity_id'))|list)|groupby('state'))['home']|count</span><span class="nv"> </span><span class="s">}}"</span>  
  <span class="na">action</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">service</span><span class="pi">:</span> <span class="s">input_boolean.turn_on</span>  
      <span class="na">entity_id</span><span class="pi">:</span> <span class="s">input_boolean.person2_home</span>
</code></pre></div></div>

<p>This triggers when any of the individual trackers comes home, and then checks to see if at least two members of the group are home. Then if they are turns on an input boolean. Obviously there’s a matching away automation that turns it off.</p>

<h2 id="going-forwards">Going forwards</h2>

<p>I’ll be comparing the results of these over the next few weeks. In theory I should find a perfect match, at which point I can switch to using the bayesian sensor.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#home-assistant" class="page__taxonomy-item" rel="tag">home assistant</a><span class="sep">, </span>
    
      <a href="/tags/#presence-detection" class="page__taxonomy-item" rel="tag">presence detection</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-09-06T21:00:00+01:00">September 6, 2018</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/turbulence-ahead-fasten-your-seatbelt/" class="pagination--pager" title="Turbulence ahead - fasten your seatbelt
">Previous</a>
    
    
      <a href="/home-assistant-cloud-goes-paid/" class="pagination--pager" title="Home Assistant cloud goes paid
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog-migration/" rel="permalink">Blog migration (2022)
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-12-22T09:00:00+00:00">December 22, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">If you’re reading this you’re looking at the new home of my blog. I’m moving off of Blogger and over to Jekyll, possibly on GitHub pages possibly on Cloudfla...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/traefik-and-remote-home-assistant/" rel="permalink">Traefik and a remote Home Assistant
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-10-25T21:17:00+01:00">October 25, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I’ve been playing with Traefik lately, for remote access for various things in my Docker stack, and I decided to see if it was possible to also use it for Ho...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/frigate-motioneyedoods/" rel="permalink">Frigate &gt; MotionEye+Doods
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-09-20T21:02:00+01:00">September 20, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">As you may remember, I use MotionEye and Doods, along withsome crazy scripting, to do motion and object detection at the front of the house.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-should-i-install-home-assistant/" rel="permalink">How should I install Home Assistant?
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-12-23T16:24:00+00:00">December 23, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description"> I see a lot of people confused by the four install options for Home Assistant.

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/DubhAd/Home-AssistantConfig/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> My HA config</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Tinkerer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
